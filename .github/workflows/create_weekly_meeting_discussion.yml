name: Create weekly meeting discussion

on:
  workflow_dispatch:
  schedule:
    # NOTE: Discussionを作成するタイミングに合わせて修正してください。
    # 毎週水曜 13:00 JST
    - cron: "0 4 * * wed"

env:
  # NOTE: ミーティング実施曜日を指定してください。
  TARGET_DAY: "wednesday"
  # NOTE: タイトルを修正してください。自動で「yyyy/mm/dd タイトル」というように、ミーティング実施日が付与されます。
  TITLE: "Discussionのタイトル"
  # NOTE: 設定したいカテゴリに合わせて修正してください。
  # 指定するのは、各カテゴリを選択した時のURL末尾の文字列です。以下は例です。
  # カテゴリ Meeting notesの場合は、以下のURLのようになり "meeting-notes" を指定します。
  # https://github.com/<org>/<repo>/discussions/categories/meeting-notes
  CATEGORY_SLUG: "meeting-notes"
  # NOTE: descriptionに利用するテンプレートファイルを事前に準備し、パスを指定してください。
  # 以下は、リポジトリに "_templates/weekly_meeting_discussion/huddle.md" というファイルがある想定です。
  DESCRIPTION_TEMPLATE_PATH: "_templates/weekly_meeting_discussion/huddle.md"

jobs:
  calc_next_weekly_date:
    uses: route06/actions/.github/workflows/calc_next_date.yml@v2
    with:
      interval: weekly
      target_day: $TARGET_DAY
  
  create_discussion:
    needs: [calc_next_weekly_date]
    uses: route06/actions/.github/workflows/create_gh_discussion.yml@v2
    with:
      title: ${{ needs.calc_next_weekly_date.outputs.next_date }} $TITLE
      category_slug: $DISCUSSION_CATEGORY_SLUG
      description_template_path: $DESCRIPTION_TEMPLATE_PATH